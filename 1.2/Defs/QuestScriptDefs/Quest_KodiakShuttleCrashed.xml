<?xml version="1.0" encoding="utf-8" ?>
<Defs>

  <QuestScriptDef>
    <defName>RE_LodiakShuttleCrash1</defName>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <rootMinPoints>350</rootMinPoints>
    <canGiveRoyalFavor>false</canGiveRoyalFavor>
    <expireDaysRange>2~3</expireDaysRange>
    <questNameRules>
      <rulesStrings>
        <li>questName->[adjective] shuttle</li>
        <li>adjective->Crashed</li>
        <li>adjective->Broken</li>
        <li>adjective->Collapsed</li>
        <li>adjective->Fallen</li>
        <li>adjective->Defective</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->High command of [asker_faction_name] lost contact with one of their Kodiak shuttles performing a routine scouting mission near [map_definite]. They are particularly interested in the data from the shuttle black box, which will be automatically uploaded once you get in range.
[asker_faction_name] has no personnel they can spare to launch a rescue operation. As such, if there are any survivors, they can choose freely to return with you to [map_definite].

Crash might have attracted the attention of hostiles.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="RimEffect.QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <mustBeNonHostileToPlayer>true</mustBeNonHostileToPlayer>
          <factionDef>RE_SystemsAlliance</factionDef>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>RE_KodiakShuttleCrash</tag>
            </li>
            <li>
              <tag>RE_WoundedSoldier</tag>
            </li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>

        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <letterDef>PositiveEvent</letterDef>
                <label TKey="LetterLabelQuestExpired">Quest completed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">You arrived at the shuttle crash site.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Success</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(7,15)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The shuttle has been found by others. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
            <outcome>Success</outcome>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>RE_LodiakShuttleCrash2</defName>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <rootMinPoints>350</rootMinPoints>
    <canGiveRoyalFavor>false</canGiveRoyalFavor>
    <expireDaysRange>2~3</expireDaysRange>
    <questNameRules>
      <rulesStrings>
        <li>questName->[adjective] shuttle</li>
        <li>adjective->Crashed</li>
        <li>adjective->Broken</li>
        <li>adjective->Collapsed</li>
        <li>adjective->Fallen</li>
        <li>adjective->Defective</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->High command of [asker_faction_name] lost contact with one of their Kodiak shuttles performing a routine scouting mission near [map_definite]. They are particularly interested in the data from the shuttle black box, which will be automatically uploaded once you get in range.
[asker_faction_name] has no personnel they can spare to launch a rescue operation. As such, if there are any survivors, they can choose freely to return with you to [map_definite].

Crash might have attracted the attention of hostiles.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="RimEffect.QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <mustBeNonHostileToPlayer>true</mustBeNonHostileToPlayer>
          <factionDef>RE_SystemsAlliance</factionDef>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>RE_KodiakShuttleCrash</tag>
            </li>
            <li>
              <tag>RE_DeadSoldier</tag>
            </li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>

        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>site.AllEnemiesDefeated</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <letterDef>PositiveEvent</letterDef>
                <label TKey="LetterLabelQuestExpired">Quest completed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">You arrived at the shuttle crash site.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Success</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(7,15)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The shuttle has been found by others. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
            <outcome>Success</outcome>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>RE_LodiakShuttleCrash3</defName>
    <rootSelectionWeight>1.0</rootSelectionWeight>
    <rootMinPoints>350</rootMinPoints>
    <canGiveRoyalFavor>false</canGiveRoyalFavor>
    <expireDaysRange>2~3</expireDaysRange>
    <questNameRules>
      <rulesStrings>
        <li>questName->[adjective] shuttle</li>
        <li>adjective->Crashed</li>
        <li>adjective->Broken</li>
        <li>adjective->Collapsed</li>
        <li>adjective->Fallen</li>
        <li>adjective->Defective</li>
      </rulesStrings>
    </questNameRules>
    <questDescriptionRules>
      <rulesStrings>
        <li>questDescription->High command of [asker_faction_name] lost contact with one of their Kodiak shuttles performing a routine scouting mission near [map_definite]. They are particularly interested in the data from the shuttle black box, which will be automatically uploaded once you get in range.
[asker_faction_name] has no personnel they can spare to launch a rescue operation. As such, if there are any survivors, they can choose freely to return with you to [map_definite].

Crash might have attracted the attention of hostiles.</li>
      </rulesStrings>
    </questDescriptionRules>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_SubScript">
          <def>Util_RandomizePointsChallengeRating</def>
          <parms>
            <pointsFactorTwoStar>1.5</pointsFactorTwoStar>
            <pointsFactorThreeStar>2</pointsFactorThreeStar>
          </parms>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_GetDefaultRewardValueFromPoints</def>
        </li>
        <li Class="QuestNode_SubScript">
          <def>Util_AdjustPointsForDistantFight</def>
        </li>
        <li Class="QuestNode_GetMap" />

        <li Class="RimEffect.QuestNode_GetPawn">
          <storeAs>asker</storeAs>
          <mustBeFactionLeader>true</mustBeFactionLeader>
          <mustBeNonHostileToPlayer>true</mustBeNonHostileToPlayer>
          <factionDef>RE_SystemsAlliance</factionDef>
        </li>

        <li Class="QuestNode_GetSiteTile">
          <storeAs>siteTile</storeAs>
          <preferCloserTiles>true</preferCloserTiles>
        </li>

        <li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
          <storeAs>sitePartDefs</storeAs>
          <storeFactionAs>siteFaction</storeFactionAs>
          <sitePartsTags>
            <li>
              <tag>RE_KodiakShuttleCrash</tag>
            </li>
            <li>
              <tag>RE_PirateOrMech</tag>
            </li>
          </sitePartsTags>
          <mustBeHostileToFactionOf>$asker</mustBeHostileToFactionOf>
        </li>

        <li Class="QuestNode_GetDefaultSitePartsParams">
          <tile>$siteTile</tile>
          <faction>$siteFaction</faction>
          <sitePartDefs>$sitePartDefs</sitePartDefs>
          <storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
        </li>

        <li Class="QuestNode_SubScript">
          <def>Util_GenerateSite</def>
        </li>

        <li Class="QuestNode_SpawnWorldObjects">
          <worldObjects>$site</worldObjects>
        </li>

        <li Class="QuestNode_Signal">
          <inSignal>ShuttleDefenseOver</inSignal>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <letterDef>PositiveEvent</letterDef>
                <label TKey="LetterLabelQuestExpired">Quest completed: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">You arrived at the shuttle crash site and defeated the hostile forces.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Success</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_WorldObjectTimeout">
          <worldObject>$site</worldObject>
          <isQuestTimeout>true</isQuestTimeout>
          <delayTicks>$(randInt(7,15)*60000)</delayTicks>
          <inSignalDisable>site.MapGenerated</inSignalDisable>
          <node Class="QuestNode_Sequence">
            <nodes>
              <li Class="QuestNode_Letter">
                <label TKey="LetterLabelQuestExpired">Quest expired: [resolvedQuestName]</label>
                <text TKey="LetterTextQuestExpired">The shuttle has been found by others. The quest [resolvedQuestName] has expired.</text>
              </li>
              <li Class="QuestNode_End">
                <outcome>Fail</outcome>
              </li>
            </nodes>
          </node>
        </li>

        <li Class="QuestNode_NoWorldObject">
          <worldObject>$site</worldObject>
          <node Class="QuestNode_End">
            <outcome>Success</outcome>
          </node>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

</Defs>